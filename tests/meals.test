const request = require('supertest');
// const express = require('express');
const router = require('../dist/routes/meal-router').default;
const bodyParser = require("body-parser");
const app = require('../dist/app').default;

app.use(bodyParser.urlencoded({ extended: false }));
app.use(bodyParser.json());

app.use('/meal', router);

describe('POST /meal', () => {
    test("It should post a new meal record", done => {
        request(app)
            .post("/meal")
            .send({
                "date": Date.now().toString(),
                "actual": "Woohoo",
                "onPlan": true,
                "hungriness": "medium",
                "satisfaction": "minimal",
                "mealType": "Snack"
            })
            .then(response => {
                expect(response.statusCode).toBe(200);
                done();
            })
            .catch(err => {
                console.log(err);
                done();
            });
    });
});

describe('GET /meal', () => {
    test("It should response the GET method", done => {
        request(app)
            .get("/meal")
            .then(response => {
                expect(response.statusCode).toBe(200);
                done();
            });
    });
    test("It should respond with an array", done => {
        request(app)
            .get("/meal")
            .then(response => {
                expect(Array.isArray(response.body)).toBe(true);
                done();
            });
    })
});

describe('GET /meal by id', () => {
    test("It should response the GET method", done => {
        request(app)
            .get("/meal/1")
            .then(response => {
                expect(response.statusCode).toBe(200);
                done();
            });
    });
});